<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finalizar Donación - Anteojos Ediciones</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --verde-principal: #0a6b63;
        --verde-oscuro: #064f49;
        --acento: #78c8c3;
        --fondo: #fbfcfb;
        --card: #ffff;
        --texto: #1f1f1f;
        --muted: #6b7280;
        --danger: #dc2626;
        --radius: 14px;
        --shadow: 0 8px 30px rgba(10, 107, 99, 0.06);
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: "Raleway", sans-serif;
        margin: 0;
        background: linear-gradient(180deg, #f7fbfa 0%, var(--fondo) 100%);
        color: var(--texto);
        -webkit-font-smoothing: antialiased;
        padding: 2.5rem 1rem;
      }

      .page {
        max-width: 1100px;
        margin: 0 auto;
      }
      header.page-head {
        text-align: center;
        margin-bottom: 1.75rem;
      }
      header.page-head h1 {
        margin: 0;
        font-size: 1.9rem;
        color: var(--verde-principal);
        font-weight: 700;
      }
      header.page-head p {
        margin-top: 0.4rem;
        color: var(--muted);
      }

      .checkout-grid {
        display: grid;
        grid-template-columns: 1fr 360px;
        gap: 24px;
        align-items: start;
      }

      .card {
        background: var(--card);
        border-radius: var(--radius);
        padding: 22px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(10, 10, 10, 0.03);
      }

      form fieldset {
        border: none;
        margin: 0 0 1.25rem 0;
        padding: 0;
      }
      .section-title {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
      }
      .section-title h2 {
        font-size: 1.05rem;
        margin: 0;
        color: var(--verde-oscuro);
        font-weight: 700;
      }

      label {
        display: block;
        font-size: 0.95rem;
        margin-bottom: 6px;
        color: #2b2b2b;
        font-weight: 600;
      }
      .input {
        width: 100%;
        padding: 12px 14px;
        border-radius: 10px;
        border: 1px solid #e6e9ea;
        background: #fff;
        font-size: 0.98rem;
        outline: none;
        transition:
          box-shadow 0.15s ease,
          border-color 0.15s ease;
      }
      .input:focus {
        border-color: var(--acento);
        box-shadow: 0 4px 18px rgba(120, 200, 195, 0.14);
      }

      .row {
        display: flex;
        gap: 12px;
      }
      .col {
        flex: 1;
      }

      .summary {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }
      .summary .muted {
        color: var(--muted);
        font-weight: 500;
        font-size: 0.95rem;
      }
      .total {
        font-size: 1.25rem;
        font-weight: 800;
        color: var(--verde-oscuro);
      }

      .btn {
        display: inline-block;
        background: linear-gradient(
          90deg,
          var(--verde-principal),
          var(--verde-oscuro)
        );
        color: #fff;
        border: none;
        padding: 12px 18px;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 800;
        font-size: 1rem;
        width: 100%;
        box-shadow: 0 8px 22px rgba(10, 107, 99, 0.12);
        transition: transform 0.08s ease;
      }
      .btn.secondary {
        background: #f3f4f6;
        color: #111827;
        box-shadow: none;
        border-radius: 10px;
        padding: 10px 14px;
        font-weight: 700;
        width: auto;
      }

      .note {
        font-size: 0.9rem;
        color: var(--muted);
        margin-top: 10px;
      }

      @media (max-width: 980px) {
        .checkout-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header class="page-head">
        <h1>Finalizar Donación</h1>
        <p>Completa tus datos para procesar la donación.</p>
      </header>

      <section class="checkout-grid">
        <div class="card">
          <form
            id="checkout-form"
            action="https://formsubmit.co/anteojosedicionessitioweb@gmail.com"
            method="POST"
            novalidate
          >
            <input type="hidden" name="_captcha" value="false" />
            <input type="hidden" name="_next" value="/gracias_donacion.html" />
            <input
              type="hidden"
              name="_subject"
              value="Nueva Donación - Anteojos Ediciones"
            />

            <fieldset>
              <div class="section-title">
                <h2>
                  Información Personal
                  <span style="color: var(--danger)">*</span>
                </h2>
              </div>

              <div class="row" style="margin-bottom: 12px">
                <div class="col">
                  <label for="nombre">Nombre y Apellido</label>
                  <input
                    class="input"
                    type="text"
                    id="nombre"
                    name="nombre"
                    required
                    placeholder="Ej: María Pérez"
                  />
                </div>
              </div>

              <div class="row" style="margin-bottom: 12px">
                <div class="col">
                  <label for="email">Correo electrónico</label>
                  <input
                    class="input"
                    type="email"
                    id="email"
                    name="email"
                    required
                    placeholder="ejemplo@correo.com"
                  />
                </div>
              </div>

              <div class="row" style="margin-bottom: 12px">
                <div class="col">
                  <label for="whatsapp">Número de WhatsApp</label>
                  <input
                    class="input"
                    type="tel"
                    id="whatsapp"
                    name="whatsapp"
                    required
                    placeholder="3001234567"
                  />
                </div>
              </div>
            </fieldset>

            <div style="display: flex; gap: 12px; align-items: center">
              <button
                type="button"
                class="btn secondary"
                onclick="history.back()"
              >
                Volver
              </button>
              <button type="submit" class="btn">Finalizar Donación</button>
            </div>
            <div class="note">
              Al pulsar "Finalizar Donación" se enviará tu pedido por correo
              electrónico.
            </div>
          </form>
        </div>

        <aside class="card">
          <div class="section-title"><h2>Resumen de la orden</h2></div>
          <div class="summary">
            <div
              id="cart-items-summary"
              style="
                margin-bottom: 10px;
                font-size: 0.9rem;
                color: var(--muted);
              "
            ></div>
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <div class="muted">Subtotal</div>
              <div id="subtotal-display" class="muted">$0</div>
            </div>
            <div style="height: 1px; background: #eef2f2; margin: 8px 0"></div>
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <div class="total">Total</div>
              <div class="total" id="total-display">$0</div>
            </div>
          </div>
        </aside>
      </section>
    </div>

    <script>
      function formatCOP(num) {
        return "$" + Number(num).toLocaleString("es-CO");
      }

      function loadCartData() {
        try {
          const cartRaw = localStorage.getItem("cart");
          if (cartRaw) {
            const cart = JSON.parse(cartRaw);
            if (Array.isArray(cart)) return cart;
          }
        } catch (e) {
          console.error("Error al cargar carrito", e);
        }
        return [];
      }

      function refreshSummary() {
        const cart = loadCartData();
        const subtotal = cart.reduce((s, i) => s + (Number(i.price) || 0), 0);

        const itemsContainer = document.getElementById("cart-items-summary");
        const subtotalEl = document.getElementById("subtotal-display");
        const totalEl = document.getElementById("total-display");

        // Mostrar lista de productos
        if (cart.length > 0) {
          itemsContainer.innerHTML = cart
            .map((i) => `<div>${i.name} - ${formatCOP(i.price)}</div>`)
            .join("");
        } else {
          itemsContainer.innerHTML = "El carrito está vacío";
        }

        subtotalEl.textContent = formatCOP(subtotal);
        totalEl.textContent = formatCOP(subtotal);
        return subtotal;
      }

      const form = document.getElementById("checkout-form");
      form.addEventListener("submit", function (evt) {
        evt.preventDefault();

        const nombre = document.getElementById("nombre").value.trim();
        const email = document.getElementById("email").value.trim();
        const whatsapp = document.getElementById("whatsapp").value.trim();

        if (!nombre || !email || !whatsapp) {
          alert("Por favor completa los campos obligatorios.");
          return;
        }

        const cart = loadCartData();
        const total = cart.reduce((s, i) => s + (Number(i.price) || 0), 0);
        const cartDetails = cart
          .map((i) => `${i.name} - ${formatCOP(i.price)}`)
          .join("\n");

        // Campos dinámicos para FormSubmit
        const addHidden = (name, value) => {
          let input = document.getElementsByName(name)[0];
          if (!input) {
            input = document.createElement("textarea");
            input.name = name;
            input.style.display = "none";
            form.appendChild(input);
          }
          input.value = value;
        };

        addHidden("Detalles del Carrito", cartDetails || "Sin productos");
        addHidden("Monto Total", formatCOP(total));

        form.submit();
      });

      // Inicializar al cargar
      window.onload = refreshSummary;
    </script>
  </body>
</html>
